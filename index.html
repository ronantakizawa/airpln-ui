<head>
    <style>
        body { margin: 0; }
    </style>
    <script src="//unpkg.com/globe.gl"></script>
</head>

<body>
    <div id="globeViz"></div>

    <script type="module">
        import * as THREE from 'https://esm.sh/three';
        import { GLTFLoader } from 'https://esm.sh/three/examples/jsm/loaders/GLTFLoader.js';

        const world = Globe()(document.getElementById('globeViz'))
            .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
            .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png');

        // Disable controls and set faster rotation
        world.controls().enabled = false;
        world.controls().autoRotate = true;
        world.controls().autoRotateSpeed = 2.0;

        const AIRPLANE_SCALE = 1;
        const AIRPLANE_DISTANCE = 150;
        const ROTATION_SPEED = (world.controls().autoRotateSpeed * (Math.PI / 180)) * 0.07;

        // Add lighting to better see the model
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        world.scene().add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
        directionalLight.position.set(0, 1, 1);
        world.scene().add(directionalLight);

        // Create a parent object for the airplane
        const airplaneParent = new THREE.Object3D();
        // Set initial rotation to position the airplane behind the Earth
        airplaneParent.rotation.y = Math.PI / 8; // Start from 90 degrees behind
        world.scene().add(airplaneParent);

        // Add airplane model
        const loader = new GLTFLoader();
        loader.load('Plane.glb', (gltf) => {
            const airplane = gltf.scene;
            airplane.scale.set(AIRPLANE_SCALE, AIRPLANE_SCALE, AIRPLANE_SCALE);

            // Position airplane in the center
            airplane.position.set(0, 0, AIRPLANE_DISTANCE);


            // Add the airplane to the parent object
            airplaneParent.add(airplane);

            // Animation loop
            function animate() {
                // Rotate the airplane parent in the opposite direction
                airplaneParent.rotation.y -= ROTATION_SPEED;

                // Keep airplane's local orientation fixed
                airplane.rotation.x = 0;
                airplane.rotation.y = -90;
                airplane.rotation.z = 0;

                requestAnimationFrame(animate);
            }
            animate();
        });
    </script>
</body>